# 阶段 7: 前端开发

## 状态

🟢 已完成

## 目标

开发车载横屏 UI，实现氛围可视化和 Agent 思维链展示。

## 前置依赖

- [x] 阶段 6: API 与 Mock（需要后端 API 可用）

## 架构决策

| 决策项 | 选择 | 说明 |
|--------|------|------|
| 框架 | Vue 3 + TypeScript | Composition API + `<script setup>` |
| 构建工具 | Vite | 快速开发体验 |
| 3D 可视化 | TresJS | Vue 生态的 Three.js 封装 |
| UI 组件库 | 无（手写样式） | 完全自定义车载风格 |
| CSS 方案 | UnoCSS | 原子化 CSS，按需生成 |
| 状态管理 | Pinia（单 Store） | 简单直接 |
| SSE 处理 | fetch + ReadableStream | 支持 POST 和自定义 Header |
| 屏幕比例 | 21:9 | 超宽屏车载屏幕 |
| 配色风格 | 白色调 + 蓝色强调 | 匹配白色内饰 |
| 主题模式 | 浅色 + 深色 | 支持夜间模式 |
| 演示数据 | 后端生成 | 调用 EnvironmentSimulator |

详细设计见：[前端架构设计](../design/frontend-architecture.md)

## 任务清单

### 页面布局

- [x] 实现 21:9 超宽屏布局
- [x] 创建主要区域划分
  - 左侧：环境信息面板
  - 中央：氛围可视化（3D）
  - 右侧：音乐播放器 + 串词展示 + 香氛 + 按摩
  - 底部：Agent 思维链（可折叠）
- [ ] 实现浅色/深色主题切换（待扩展）

### 环境信息展示

- [x] 显示当前环境数据
  - GPS 标签、天气、车速
  - 时段、乘客数量、路线类型
- [x] 用户情绪选择器
- [x] 环境数据实时更新

### 氛围灯可视化

- [x] 创建氛围可视化组件（CSS 动效替代 3D）
- [x] 实现氛围灯动效
  - 颜色渐变
  - 呼吸灯效果
- [x] 根据 LightSetting 实时更新灯光

### 音乐播放器

- [x] 显示当前播放歌曲信息
- [x] 播放列表展示
- [ ] 播放控制（上一首/下一首/暂停）（待扩展）
- [ ] 进度条（待扩展）

### 串词展示

- [x] 显示 Agent 生成的串词
- [x] 打字机效果展示
- [ ] TTS 播放按钮（待扩展）

### Agent 思维链展示

- [x] 显示 Agent 的推理过程
- [x] 展示调用了哪些工具
- [x] 展示每个工具的输入输出
- [x] 终端风格界面 + 打字机效果

### API 集成

- [x] 封装 API 调用服务
- [x] 实现状态管理（Pinia）
- [x] 处理加载状态和错误状态
- [x] SSE 订阅（流式分析）

### 演示模式

- [x] 实现一键演示功能
- [x] 场景选择弹窗（预设 + AI 生成）
- [x] 展示"环境变 → Vibe 变"的效果

## 相关文件

```
vibe-drive-frontend/
├── src/
│   ├── assets/styles/
│   │   └── theme.css              # 主题变量
│   ├── components/
│   │   ├── layout/
│   │   │   └── AppLayout.vue      # 主布局
│   │   ├── environment/
│   │   │   ├── EnvironmentPanel.vue
│   │   │   └── MoodSelector.vue
│   │   ├── ambience/
│   │   │   └── AmbienceVisualizer.vue
│   │   ├── music/
│   │   │   └── MusicPlayer.vue
│   │   ├── narrative/
│   │   │   └── NarrativeDisplay.vue
│   │   └── agent/
│   │       └── ThinkingChain.vue
│   ├── composables/
│   │   ├── useSSE.ts              # SSE 连接管理
│   │   └── useTheme.ts            # 主题切换
│   ├── services/
│   │   ├── api.ts                 # API 封装
│   │   └── types.ts               # API 类型定义
│   ├── stores/
│   │   └── vibeStore.ts           # Pinia 状态管理
│   ├── App.vue
│   └── main.ts
├── index.html
├── package.json
├── tsconfig.json
├── vite.config.ts
└── uno.config.ts                  # UnoCSS 配置
```

## 完成标准

- [x] UI 界面完整，适配车载横屏
- [x] 氛围灯动效流畅
- [x] Agent 思维链可视化清晰
- [x] 演示模式可正常运行
- [x] 代码已提交到 Git

## 扩展功能（已完成）

- [x] 香氛系统（ScentDisplay 组件）
- [x] 按摩系统（MassageDisplay 组件）
- [x] 环境生成智能体（AI 根据描述生成环境）
- [x] 场景选择弹窗（预设场景 + AI 生成）

## 问题与笔记

- TresJS 3D 组件配置复杂，改用 CSS 动效实现氛围可视化
- SSE 事件类型需要正确解析 `event:` 行
- 后端返回小写枚举值，前端需要大小写转换
- Token 事件字段名为 `content`（非 `text`）
