# 探索文档：主智能体设计

## 探索目标

设计 Vibe Drive 的主智能体（Master Agent），用于演示系统的完整能力。

## 背景

### 当前状态

现有 `VibeAgent` 是一个氛围编排智能体，具备以下工具：
- `MusicTool` - 音乐搜索与播放
- `MusicSeedTool` - 音乐灵感种子
- `LightTool` - 氛围灯控制
- `ScentTool` - 香氛控制
- `MassageTool` - 按摩椅控制
- `NarrativeTool` - 叙事生成

### 定位

**主智能体是演示用途**：
- 拥有 Vibe Drive 所有工具
- 不连接真实车机硬件
- 用于展示系统能力和交互体验

---

## 待探索话题

- [ ] 话题1：主智能体与氛围智能体的关系
- [ ] 话题2：主智能体的能力边界
- [ ] 话题3：对话交互设计
- [ ] 话题4：演示场景设计

---

## 探索记录

### 话题1：主智能体与氛围智能体的关系

**讨论日期**：2025-12-26

#### 1.1 架构选择

**选定方案：B - 多 Agent 协作**

```
┌─────────────────────────────────────┐
│         主智能体 (Master Agent)      │
│  - 对话理解                          │
│  - 意图识别                          │
│  - 任务分发                          │
└──────────────┬──────────────────────┘
               │ 调用
               ▼
┌─────────────────────────────────────┐
│         氛围智能体 (Vibe Agent)      │
│  - 氛围编排                          │
│  - 工具调用                          │
│  - 环境感知                          │
└─────────────────────────────────────┘
```

#### 1.2 职责划分

| 智能体 | 职责 | 工具 |
|--------|------|------|
| 主智能体 | 对话、意图理解、任务分发 | ？ |
| 氛围智能体 | 氛围编排 | Music, Light, Scent, Massage, Narrative |

#### 1.3 主智能体的双重身份

**选定方案：C - 始终融合**

主智能体同时具备两种能力，自然融合：

| 层面 | 能力 | 示例 |
|------|------|------|
| 角色层 | 车机智能体 | "播放轻音乐"、"调暗灯光" |
| 元认知层 | 项目自知 | "你能做什么"、"这个怎么实现的" |

**特点**：
- 知道自己是虚拟演示环境
- 了解 Vibe Drive 项目的功能和架构
- 不需要显式切换模式

#### 1.4 异步调用与消息队列

**调用方式**：异步调用 + 用户优先消息队列

```
┌───────────────────────────────────────────────┐
│                 主智能体                        │
│                                               │
│  ┌─────────────┐      ┌─────────────────┐    │
│  │ 用户消息队列  │─────▶│                 │    │
│  │ (高优先级)   │      │    处理中心      │    │
│  └─────────────┘      │                 │    │
│                       │ 用户优先        │    │
│  ┌─────────────┐      │ 可中断氛围处理   │    │
│  │ 氛围消息队列  │─────▶│                 │    │
│  │ (低优先级)   │      └─────────────────┘    │
│  └─────────────┘                              │
└───────────────────────────────────────────────┘
```

**处理规则**：

| 场景 | 行为 |
|------|------|
| 正在处理用户消息 | 氛围结果入队等待 |
| 正在处理氛围结果 + 用户消息进来 | 中断，氛围结果存回队列，优先处理用户 |
| 空闲 | 按优先级取队列消息处理 |

**中断策略**：B - 暂存继续
- 氛围智能体返回一次性完整结果
- 中断时直接存回队列
- 用户处理完后继续处理

#### 1.5 语音交互方案

**简化决策**：放弃监听型，采用对讲机模式

```
用户按住按钮 → 说话 → 松开 → Whisper 转文本 → 发给主智能体
```

**语音转文本**：本地 Whisper（Docker 部署）
- 镜像：`onerahmet/openai-whisper-asr-webservice:latest-gpu`
- 端口：9000
- 模型：medium 或 large-v3
- 硬件：4060 Laptop（8GB 显存）

---

### 话题2：实现计划

#### 2.1 架构图

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   前端       │     │  Whisper    │     │  Java 后端  │
│  (Vue)      │     │  (Docker)   │     │             │
│             │     │             │     │             │
│ 录音按钮 ────┼────▶│ ASR 转写 ───┼────▶│ 主智能体    │
│             │     │  :9000      │     │             │
└─────────────┘     └─────────────┘     └─────────────┘
```

#### 2.2 待实现

- [ ] Docker 部署 Whisper 服务
- [ ] 前端录音组件
- [ ] 前端调用 Whisper API
- [ ] 集成到对话流程

---

## 参考资源

- 现有代码：`VibeAgentFactory.java`
- 系统提示词：`vibe-system.txt`
