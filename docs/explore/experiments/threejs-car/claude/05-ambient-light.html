<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>测试05：氛围灯带场景</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        canvas { display: block; }
        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
        }
        .color-btn {
            width: 40px;
            height: 40px;
            border: 2px solid #fff;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .color-btn:hover { transform: scale(1.1); }
        .color-btn.active { border-width: 4px; }
        .toggle-btn {
            padding: 10px 20px;
            background: #333;
            color: #fff;
            border: 2px solid #fff;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
        }
        .toggle-btn.active { background: #00aaff; }
    </style>
</head>
<body>
    <div class="controls">
        <button class="color-btn active" style="background: #ff0000;" data-color="0xff0000"></button>
        <button class="color-btn" style="background: #00aaff;" data-color="0x00aaff"></button>
        <button class="color-btn" style="background: #00ff00;" data-color="0x00ff00"></button>
        <button class="color-btn" style="background: #aa00ff;" data-color="0xaa00ff"></button>
        <button class="color-btn" style="background: #ffffff;" data-color="0xffffff"></button>
        <button class="toggle-btn active" id="breathToggle">呼吸效果</button>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // 场景设置
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);

        // 相机设置
        const camera = new THREE.PerspectiveCamera(75, 800 / 600, 0.1, 1000);
        camera.position.set(0, 2, 5);

        // 渲染器设置
        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(800, 600);
        document.body.appendChild(renderer.domElement);

        // 灯带材质
        let currentColor = new THREE.Color(0x00aaff);
        const lightStripMaterials = [];

        function createLightStrip(width, height, position, rotation = [0, 0, 0]) {
            const geometry = new THREE.PlaneGeometry(width, height);
            const material = new THREE.MeshBasicMaterial({
                color: currentColor,
                side: THREE.DoubleSide
            });
            lightStripMaterials.push(material);
            const strip = new THREE.Mesh(geometry, material);
            strip.position.set(...position);
            strip.rotation.set(...rotation);
            return strip;
        }

        // 顶部灯带
        const topStrip = createLightStrip(4, 0.1, [0, 2, -2]);
        scene.add(topStrip);

        // 底部灯带
        const bottomStrip = createLightStrip(4, 0.1, [0, 0, -2]);
        scene.add(bottomStrip);

        // 左侧灯带
        const leftStrip = createLightStrip(2, 0.1, [-2, 1, -2], [0, 0, Math.PI / 2]);
        scene.add(leftStrip);

        // 右侧灯带
        const rightStrip = createLightStrip(2, 0.1, [2, 1, -2], [0, 0, Math.PI / 2]);
        scene.add(rightStrip);

        // OrbitControls
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // 呼吸效果状态
        let breathingEnabled = true;
        let breathPhase = 0;

        // 颜色切换
        document.querySelectorAll('.color-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const colorValue = parseInt(btn.dataset.color);
                currentColor.setHex(colorValue);
                lightStripMaterials.forEach(mat => mat.color.setHex(colorValue));
            });
        });

        // 呼吸效果开关
        document.getElementById('breathToggle').addEventListener('click', (e) => {
            breathingEnabled = !breathingEnabled;
            e.target.classList.toggle('active');
        });

        // 动画循环
        function animate() {
            requestAnimationFrame(animate);

            if (breathingEnabled) {
                breathPhase += 0.03;
                const intensity = 0.3 + 0.7 * (0.5 + 0.5 * Math.sin(breathPhase));
                lightStripMaterials.forEach(mat => {
                    mat.opacity = intensity;
                    mat.transparent = true;
                });
            } else {
                lightStripMaterials.forEach(mat => {
                    mat.opacity = 1;
                    mat.transparent = false;
                });
            }

            controls.update();
            renderer.render(scene, camera);
        }

        animate();
    </script>
</body>
</html>
